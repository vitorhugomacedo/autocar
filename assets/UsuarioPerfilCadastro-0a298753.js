var A=Object.defineProperty;var N=(t,e,o)=>e in t?A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var y=(t,e,o)=>(N(t,typeof e!="symbol"?e+"":e,o),o);import{P as E}from"./PerfilUsuarioService-ba568dd0.js";import{A as U,_ as L,l as O,m as R,n as F,b as n,c as m,d as S,f as r,e as s,t as d,g as c,F as x,k as H,q as w,i as p,z as j,B as q}from"./index-def3a469.js";import{c as z,a as G}from"./index.esm-960d875f.js";import"./UrlService-8cfe23a9.js";class Q{constructor(){y(this,"getAll",async e=>await U.$axios.get(`PerfilUsuarioModulo/${e}`).then(o=>o.data.data));y(this,"save",async e=>await U.$axios.post("PerfilUsuarioModulo",e).then(o=>o.data.data))}}const J={name:"UsuariosPerfilCadastro",components:{},setup(){const t=O(),e=R(),o=new E,i=new Q,{errors:l,handleSubmit:u,defineField:f}=F({validationSchema:z({descricao:G().required("Campo obrigatório")})}),[h]=f("descricao");return{router:t,toast:e,perfilUsuarioService:o,perfilUsuarioModuloService:i,descricao:h,handleSubmit:u,errors:l}},data(){return{breadcrumbHome:{icon:"pi pi-home",to:"/"},breadcrumbItems:[],modulos:[],titulo:"",isEdicao:!1,id:0,onSubmit:null,usuarioAtivo:!0,colunas:[{field:"consultar",header:"Consultar"},{field:"cadastrar",header:"Cadastrar"},{field:"editar",header:"Editar"},{field:"excluir",header:"Excluir"}],visible:!1,loading:!1}},async mounted(){if(this.isEdicao=this.router.currentRoute.value.fullPath.includes("editar"),this.titulo=this.isEdicao?"Editar Perfil de Usuário":"Novo Perfil de Usuário",this.breadcrumbItems=[{label:"Configurações",to:"/configuracoes/usuarios"},{label:"Usuários",to:"Perfil de Usuário"},{label:this.titulo,to:"#"}],this.isEdicao){const t=this.router.currentRoute.value.params.id,e=await this.perfilUsuarioService.get(t);this.id=e.id,this.descricao=e.descricao}this.modulos=await this.perfilUsuarioModuloService.getAll(this.id),this.onSubmit=this.handleSubmit(async t=>{const e={id:this.id,descricao:t.descricao};try{this.loading=!0;let o=null;this.id?o=await this.perfilUsuarioService.update(e):o=await this.perfilUsuarioService.create(e),await this.perfilUsuarioModuloService.save({idPerfil:o.id,modulos:this.modulos.map(i=>({id:i.id,idModulo:i.idModulo,cadastrar:i.cadastrar??!1,consultar:i.consultar??!1,editar:i.editar??!1,excluir:i.excluir??!1}))}),this.toast.add({severity:"success",summary:"Cadastro salvo com sucesso",detail:"",life:3e3}),setTimeout(()=>{this.router.push("/configuracoes/perfil-usuario")},400)}catch(o){this.toast.add({severity:"error",summary:o.message,detail:"",life:3e3}),this.loading=!1}})},methods:{submit:async function(){this.descricao.toUpperCase()==="ADMINISTRADOR"?this.visible=!0:this.onSubmit()},getStatusLabel(t){return t?"sucess":"danger"}}},K={class:"font-medium text-2xl text-color"},W={class:"grid p-fluid"},X={class:"col-12 md:col-12"},Y={class:"card"},Z=s("span",{class:"p-text-secondary text-align-center block mb-2 pt-2"},[p("Não é permitido gravar outro perfil "),s("br"),p(" com o nome ADMINISTRADOR.")],-1),$={class:"flex justify-content-end gap-2"},ee={key:0},oe={class:"p-input-title"},se={class:"grid formgrid"},te={class:"col-12 mb-2 lg:col-4"},ie=s("h6",{class:"p-input-title"},"Nome do Perfil",-1),ae={class:"p-error",id:"text-error"},re=s("div",{class:"flex flex-wrap align-items-center justify-content-between gap-2"},[s("span",{class:"text-large text-700"},"Módulos do Sistema")],-1),le={class:"my-2"};function ne(t,e,o,i,l,u){const f=n("Toast"),h=n("Breadcrumb"),_=n("Button"),C=n("Dialog"),T=n("InputText"),P=n("Panel"),k=n("ScrollTop"),b=n("Column"),I=n("ToggleButton"),M=n("DataTable"),B=n("router-link"),D=n("Toolbar");return m(),S(x,null,[r(f),s("div",K,d(l.titulo),1),r(h,{home:l.breadcrumbHome,model:l.breadcrumbItems},null,8,["home","model"]),s("div",W,[s("div",X,[s("div",Y,[s("form",null,[r(C,{visible:l.visible,"onUpdate:visible":e[1]||(e[1]=a=>l.visible=a),header:"Confirmação",style:{width:"25rem"}},{default:c(()=>[Z,s("div",$,[r(_,{type:"button",label:"Ok",onClick:e[0]||(e[0]=a=>l.visible=!1)})])]),_:1},8,["visible"]),r(P,{header:"Dados Principais",class:"mb-4"},{default:c(()=>[l.id?(m(),S("div",ee,[s("h6",oe,"CÓDIGO: "+d(this.id),1)])):H("",!0),s("div",se,[s("div",te,[ie,r(T,{modelValue:i.descricao,"onUpdate:modelValue":e[2]||(e[2]=a=>i.descricao=a),class:w({"p-invalid":i.errors.descricao}),type:"text"},null,8,["modelValue","class"]),s("small",ae,d(i.errors.descricao||""),1)])])]),_:1})]),r(M,{value:l.modulos,editMode:"cell",pt:{table:{style:"min-width: 50rem"},column:{bodycell:({state:a})=>({class:[{"pt-0 pb-0":a.d_editing}]})}}},{header:c(()=>[re]),footer:c(()=>[]),default:c(()=>[r(k,{icon:"pi pi-arrow-up",pt:{root:"w-2rem h-2rem secondary-color border-round-sm",icon:{class:"text-base"}}}),r(b,{field:"id",header:"Cód.",style:{width:"8%"}},{body:c(({data:a})=>[p(d(a.idModulo),1)]),_:1}),r(b,{field:"nome",header:"Nome do Módulo",style:{width:"20%"}},{body:c(({data:a})=>[p(d(a.grupo)+" - "+d(a.nome),1)]),_:1}),(m(!0),S(x,null,j(l.colunas,a=>(m(),q(b,{key:a.field,field:a.field,header:a.header,style:{width:"18%"}},{body:c(({data:v,field:g})=>[r(I,{class:w([u.getStatusLabel(v[g]),"w-10rem"]),modelValue:v[g],"onUpdate:modelValue":V=>v[g]=V,onLabel:"HABILITADO",offLabel:"BLOQUEADO",onIcon:"pi pi-check-circle",offIcon:"pi pi-times-circle","aria-label":""},null,8,["class","modelValue","onUpdate:modelValue"])]),_:2},1032,["field","header"]))),128))]),_:1},8,["value","pt"])]),r(D,null,{start:c(()=>[r(B,{to:"/configuracoes/perfil-usuario"},{default:c(()=>[r(_,{label:"Voltar",icon:"pi pi-undo",class:"p-button-secondary mr-2",raised:""})]),_:1})]),end:c(()=>[s("div",le,[r(_,{label:"Salvar",icon:"pi pi-save",class:"p-button-sucess mr-4",loading:l.loading,raised:"",onClick:u.submit},null,8,["loading","onClick"])])]),_:1})])])],64)}const fe=L(J,[["render",ne]]);export{fe as default};
