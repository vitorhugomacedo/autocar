import{A as T}from"./AfiliadoEmpresaService-21e4d85d.js";import{E as j,C as B}from"./Contatos-a43ed830.js";import{_ as k,n as w,b as l,c as E,B as I,g as v,e as o,f as r,q as _,t as u,i as b,l as K,m as q,d as x,k as F,F as A}from"./index-777c8e91.js";import{c as N,a as p}from"./index.esm-960d875f.js";const D={props:["usuario","updateUsuario"],name:"Usuario",setup(){const{errors:a,handleSubmit:e,defineField:t}=w({validationSchema:N({nome:p().required("Campo obrigatório"),email:p().required("Campo obrigatório").email("E-mail inválido"),senha:p().required("Campo obrigatório").length(6,"Deve conter pelo menos 6 dígitos")})}),[s]=t("nome"),[i]=t("email"),[n]=t("senha");return{nome:s,email:i,senha:n,handleSubmit:e,errors:a}},data(){return{onSubmit:null,valid:!1}},mounted(){this.onSubmit=this.handleSubmit(async a=>{this.valid=!0}),this.usuario!=null&&(this.nome=this.usuario.nome,this.email=this.usuario.email,this.senha=this.usuario.senha)},methods:{handleKeyup:function(){this.updateUsuario({nome:this.nome,email:this.email,senha:this.senha})},validate:async function(){return this.valid=!1,await this.onSubmit(),this.valid}},watch:{usuario:function(){this.usuario.nome!=null&&(this.nome=this.usuario.nome,this.email=this.usuario.email,this.senha=this.usuario.senha)}}},J={class:"grid formgrid"},R={class:"col-12 mb-2 lg:col-5 lg:mb-2"},L=o("h6",{class:"p-input-title"},[o("span",{class:"p-error"},"*"),b("Responsável")],-1),G={class:"p-error",id:"text-error"},H={class:"col-12 mb-2 lg:col-4 lg:mb-2"},M=o("h6",{class:"p-input-title"},[o("span",{class:"p-error"},"*"),b("E-mail")],-1),O={class:"p-error",id:"text-error"},Q={class:"col-12 mb-2 lg:col-3 lg:mb-2"},W=o("h6",{class:"p-input-title"},[o("span",{class:"p-error"},"*"),b("Senha")],-1),X={class:"p-error",id:"text-error"};function Y(a,e,t,s,i,n){const c=l("InputText"),m=l("Password"),f=l("Panel");return E(),I(f,{header:"Usuário",toggleable:"",class:"mb-4"},{default:v(()=>[o("div",J,[o("div",R,[L,r(c,{type:"text",modelValue:s.nome,"onUpdate:modelValue":e[0]||(e[0]=d=>s.nome=d),class:_({"p-invalid":s.errors.nome}),onKeyup:n.handleKeyup},null,8,["modelValue","class","onKeyup"]),o("small",G,u(s.errors.nome||""),1)]),o("div",H,[M,r(c,{type:"text",modelValue:s.email,"onUpdate:modelValue":e[1]||(e[1]=d=>s.email=d),class:_({"p-invalid":s.errors.email}),onKeyup:n.handleKeyup},null,8,["modelValue","class","onKeyup"]),o("small",O,u(s.errors.email||""),1)]),o("div",Q,[W,r(m,{modelValue:s.senha,"onUpdate:modelValue":e[2]||(e[2]=d=>s.senha=d),promptLabel:"Digite sua senha...",weakLabel:"Senha fraca",mediumLabel:"Senha média",strongLabel:"Senha forte",class:_({"p-invalid":s.errors.senha}),onKeyup:n.handleKeyup},null,8,["modelValue","class","onKeyup"]),o("small",X,u(s.errors.senha||""),1)])])]),_:1})}const Z=k(D,[["render",Y]]);function $(a){const e=a.toString().match(/\d/g);return Array.isArray(e)?e.map(Number):[]}function U(a,e){const t=e.slice(0,a);let s=a-7,i=0;for(let c=a;c>=1;c--){const m=t[a-c];i+=m*s--,s<2&&(s=9)}const n=11-i%11;return n>9?0:n}const ss={validaCNPJ:function(a){const e=/^\d{2}.\d{3}.\d{3}\/\d{4}-\d{2}$/;if(!a)return!1;const t=typeof a=="string";if(!(t||Number.isInteger(a)||Array.isArray(a)))return!1;if(t){const d=/^\d{14}$/.test(a),g=e.test(a);if(!(d||g))return!1}const i=$(a);if(i.length!==14||[...new Set(i)].length===1)return!1;const c=i.slice(12);return U(12,i)!==c[0]?!1:U(13,i)===c[1]}},os={name:"ClienteEmpresa",components:{Enderecos:j,Contatos:B,Usuario:Z},setup(){const a=K(),e=q(),t=new T,{errors:s,handleSubmit:i,defineField:n}=w({validationSchema:N({razaoSocial:p().required("Campo obrigatório"),nomeFantasia:p().required("Campo obrigatório"),cnpj:p().required("Campo obrigatório").test("cnpj-validation","CNPJ inválido",ss.validaCNPJ),inscricaoEstadual:p(),responsavel:p()})}),c=[],m=[],f=null,[d]=n("razaoSocial"),[g]=n("nomeFantasia"),[y]=n("cnpj"),[S]=n("inscricaoEstadual"),[V]=n("responsavel");return{router:a,toast:e,afiliadoEmpresaService:t,razaoSocial:d,nomeFantasia:g,cnpj:y,inscricaoEstadual:S,responsavel:V,enderecos:c,contatos:m,usuario:f,handleSubmit:i,errors:s}},data(){return{breadcrumbHome:{icon:"pi pi-home",to:"/superadmin"},breadcrumbItems:[],titulo:"",isEdicao:!1,id:0,enderecoValido:!1,contatoValido:!1,usuarioValido:!1,onSubmit:null,loading:!1}},async mounted(){if(this.isEdicao=this.router.currentRoute.value.fullPath.includes("editar"),this.titulo=this.isEdicao?"Editar Empresa":"Nova Empresa",this.breadcrumbItems=[{label:"Cadastros",to:"/superadmin/cadastros/empresas"},{label:"Empresas",to:"/superadmin/cadastros/empresas"},{label:this.titulo,to:"#"}],this.isEdicao){const a=this.router.currentRoute.value.params.id,e=await this.afiliadoEmpresaService.get(a);this.id=e.id,this.razaoSocial=e.razaoSocial,this.nomeFantasia=e.nomeFantasia,this.cnpj=e.cnpj,this.responsavel=e.responsavel??"";const t=e.enderecos[0];t&&(this.enderecos=[{id:t.id,cep:t.cep,logradouro:t.logradouro,numero:t.numero,bairro:t.bairro,complemento:t.complemento,cidade:t.cidade,uf:t.uf,codigoIBGE:t.codigoIBGE}])}this.onSubmit=this.handleSubmit(async a=>{if(!this.enderecoValido||!this.contatoValido||!this.usuarioValido)return;const e={id:this.id,razaoSocial:a.razaoSocial,nomeFantasia:a.nomeFantasia,cnpj:a.cnpj,inscricaoEstadual:a.inscricaoEstadual,responsavel:a.responsavel,enderecos:this.enderecos,contatos:this.contatos,usuario:this.usuario};try{this.loading=!0,this.id?await this.afiliadoEmpresaService.update(e):await this.afiliadoEmpresaService.create(e),this.toast.add({severity:"success",summary:"Cadastro salvo com sucesso",detail:"",life:3e3}),setTimeout(()=>{this.router.push("/superadmin/cadastros/empresas")},400)}catch(t){this.toast.add({severity:"error",summary:t.message,detail:"",life:3e3}),this.loading=!1}})},methods:{updateEnderecos:function(a){this.enderecos=a},updateContatos:function(a){this.contatos=a},updateUsuario:function(a){this.usuario=a},submit:async function(){this.enderecoValido=await this.$refs.endereco.validate(),this.contatoValido=await this.$refs.contato.validate(),this.usuarioValido=this.id!=0?!0:await this.$refs.usuario.validate(),this.onSubmit()}}},es={class:"font-medium text-2xl text-color"},as={class:"grid p-fluid"},ts={class:"col-12 md:col-12"},is={class:"card"},ns={key:0},rs={class:"p-input-title"},ls={class:"grid formgrid"},cs={class:"col-12 mb-2 lg:col-3 lg:mb-2"},ds=o("h6",{class:"p-input-title"},[o("span",{class:"p-error"},"*"),b("CNPJ")],-1),us={class:"p-error",id:"text-error"},ms={class:"col-12 mb-2 lg:col-3 lg:mb-2"},ps=o("h6",{class:"p-input-title"},"Inscrição Estadual",-1),hs={class:"p-error",id:"text-error"},_s={class:"grid formgrid"},fs={class:"col-12 mb-2 lg:col-6 lg:mb-2"},bs=o("h6",{class:"p-input-title"},[o("span",{class:"p-error"},"*"),b("Razão Social")],-1),gs={class:"p-error",id:"text-error"},vs={class:"col-12 mb-2 lg:col-6 lg:mb-2"},ys=o("h6",{class:"p-input-title"},[o("span",{class:"p-error"},"*"),b("Nome Fantasia")],-1),Es={class:"p-error",id:"text-error"},Ss={class:"my-2"};function Vs(a,e,t,s,i,n){const c=l("Toast"),m=l("Breadcrumb"),f=l("InputMasked"),d=l("InputText"),g=l("Panel"),y=l("Enderecos"),S=l("Contatos"),V=l("Usuario"),C=l("Button"),z=l("router-link"),P=l("Toolbar");return E(),x(A,null,[r(c),o("div",es,u(i.titulo),1),r(m,{home:i.breadcrumbHome,model:i.breadcrumbItems},null,8,["home","model"]),o("div",as,[o("div",ts,[o("div",is,[o("form",null,[r(g,{header:"Dados Principais",toggleable:"",class:"mb-4"},{default:v(()=>[i.id?(E(),x("div",ns,[o("h6",rs,"CÓDIGO: "+u(this.id),1)])):F("",!0),o("div",ls,[o("div",cs,[ds,r(f,{modelValue:s.cnpj,"onUpdate:modelValue":e[0]||(e[0]=h=>s.cnpj=h),class:_({"p-invalid":s.errors.cnpj}),mask:"99.999.999/9999-99"},null,8,["modelValue","class"]),o("small",us,u(s.errors.cnpj||""),1)]),o("div",ms,[ps,r(d,{modelValue:s.inscricaoEstadual,"onUpdate:modelValue":e[1]||(e[1]=h=>s.inscricaoEstadual=h),class:_({"p-invalid":s.errors.inscricaoEstadual}),type:"text"},null,8,["modelValue","class"]),o("small",hs,u(s.errors.inscricaoEstadual||""),1)])]),o("div",_s,[o("div",fs,[bs,r(d,{modelValue:s.razaoSocial,"onUpdate:modelValue":e[2]||(e[2]=h=>s.razaoSocial=h),class:_({"p-invalid":s.errors.razaoSocial}),type:"text"},null,8,["modelValue","class"]),o("small",gs,u(s.errors.razaoSocial||""),1)]),o("div",vs,[ys,r(d,{modelValue:s.nomeFantasia,"onUpdate:modelValue":e[3]||(e[3]=h=>s.nomeFantasia=h),class:_({"p-invalid":s.errors.nomeFantasia}),type:"text"},null,8,["modelValue","class"]),o("small",Es,u(s.errors.nomeFantasia||""),1)])])]),_:1}),r(y,{enderecos:s.enderecos,updateEnderecos:n.updateEnderecos,ref:"endereco"},null,8,["enderecos","updateEnderecos"]),r(S,{contatos:s.contatos,updateContatos:n.updateContatos,ref:"contato"},null,8,["contatos","updateContatos"]),i.id==0?(E(),I(V,{key:0,usuario:s.usuario,updateUsuario:n.updateUsuario,ref:"usuario"},null,8,["usuario","updateUsuario"])):F("",!0)])]),r(P,null,{start:v(()=>[r(z,{to:"/superadmin/cadastros/empresas"},{default:v(()=>[r(C,{label:"Voltar",icon:"pi pi-undo",class:"p-button-secondary mr-2",raised:""})]),_:1})]),end:v(()=>[o("div",Ss,[r(C,{label:"Salvar",icon:"pi pi-save",class:"p-button-sucess mr-4",loading:i.loading,raised:"",onClick:n.submit},null,8,["loading","onClick"])])]),_:1})])])],64)}const ks=k(os,[["render",Vs]]);export{ks as default};
